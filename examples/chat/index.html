<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agentary JS – Browser Demo</title>
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; margin: 24px; }
      pre { background: #111; color: #0f0; padding: 12px; border-radius: 6px; min-height: 120px; white-space: pre-wrap; }
      .row { margin-bottom: 12px; }
      input, button { font-size: 14px; padding: 6px 10px; }
      label { display: inline-block; min-width: 80px; }
    </style>
  </head>
  <body>
    <h1>Agentary JS – Browser Demo</h1>
    <div class="row">
      <label>Prompt</label>
      <input id="prompt" size="60" value="Hello world" />
      <button id="run">Run</button>
    </div>
    <div class="row">
      <label>Tools</label>
      <input type="checkbox" id="useTools" />
    </div>
    <div class="row" id="toolsRow" style="display:none; align-items: start; gap: 8px;">
      <label style="vertical-align: top;">Tools JSON</label>
      <textarea id="toolsJson" rows="8" cols="60">[
  {
    "type": "function",
    "function": {
      "name": "get_weather",
      "description": "Get current weather for a city.",
      "parameters": {
        "type": "object",
        "properties": {
          "city": { "type": "string", "description": "City name" }
        },
        "required": ["city"]
      }
    }
  },
  {
    "type": "function",
    "function": {
      "name": "get_time",
      "description": "Get the current time in ISO format.",
      "parameters": { "type": "object", "properties": {} }
    }
  }
]</textarea>
    </div>
    <div class="row">
      <label>HF Token</label>
      <input id="token" size="60" placeholder="Optional (for private models)" />
    </div>
    <pre id="out">Press Run…</pre>

    <script type="module">
      import { createSession } from '../../dist/index.js';

      const out = document.getElementById('out');
      const btn = document.getElementById('run');
      const promptEl = document.getElementById('prompt');
      const tokenEl = document.getElementById('token');
      const useToolsEl = document.getElementById('useTools');
      const toolsRowEl = document.getElementById('toolsRow');
      const toolsJsonEl = document.getElementById('toolsJson');

      useToolsEl.addEventListener('change', () => {
        toolsRowEl.style.display = useToolsEl.checked ? 'block' : 'none';
      });

      btn.addEventListener('click', async () => {
        out.textContent = '';
        btn.disabled = true;
        try {
          // const session = await createSession({ model: 'onnx-community/gemma-3-270m-it-ONNX', quantization: 'q4' });
          const session = await createSession({ 
            models: {
            chat: 'onnx-community/gemma-3-270m-it-ONNX',
            function_calling: 'onnx-community/Qwen2.5-0.5B-Instruct',
          }, quantization: 'q4' });
          const started = performance.now();
          let tools;
          if (useToolsEl.checked) {
            try {
              tools = JSON.parse(toolsJsonEl.value);
            } catch (e) {
              out.textContent = 'Invalid tools JSON: ' + (e?.message ?? String(e));
              btn.disabled = false;
              return;
            }
          }
          for await (const chunk of session.generate({ prompt: promptEl.value, tools })) {
            console.log('chunk', chunk);
            if (chunk.isFirst && chunk.ttfbMs) {
              out.textContent += `TTFB: ${chunk.ttfbMs.toFixed(1)}ms\n`;
            }
            if (!chunk.isLast) {
              out.textContent += chunk.token;
            }
          }
          const total = performance.now() - started;
          out.textContent += `\n\nDone in ${total.toFixed(1)}ms`;
          await session.dispose();
        } catch (err) {
          out.textContent = 'Error: ' + (err?.message ?? String(err));
        } finally {
          btn.disabled = false;
        }
      });
    </script>
  </body>
  </html>


